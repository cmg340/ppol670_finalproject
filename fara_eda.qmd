---
title: "FARA EDA"
author: "Elena Spielmann"
format: 
  html:
    code-fold: true
    self-contained: true
execute: 
  echo: true
  warning: false
  error: false
editor_options: 
  chunk_output_type: console
---

Libraries

```{r}
library(readxl)
library(dplyr)
library(tidyverse)
library(tidymodels)
library(themis)
library(rpart.plot)
library(vip)
library(lubridate)
library(rpart)
library(ranger)
library(ggplot2)
library(parsnip)
library(yardstick)

```

# 1. Set up

The Food Access Research Atlas (FARA) provides a variety of food access measures for low income and low access census tracts. Food access measures use income, transportation, and distance from grocery stores and other food sellers to determine how accessible food is to residents of a given census tract. This dataset includes distinct measures of access for urban and rural populations.

My target variable is a binary variable indicating whether an urban census tract is a low access tract at 1 mile (LATracts1) or not. I will build a machine learning model to predict this target variable, and will likely use various algorithms, including logistic regression, decision trees, and random forests.

```{r}


FARA <- read_excel("fara_2019.xlsx")

# subset the data for only urban areas with low-access tracts at one mile.
fara_subset <- FARA %>%
  select(CensusTract, State, County, Urban, Pop2010, OHU2010, HUNVFlag, LowIncomeTracts, PovertyRate, MedianFamilyIncome, GroupQuartersFlag, NUMGQTRS, PCTGQTRS, LATracts1, lapop1, lapop1share, lalowi1, lalowi1share, lakids1, lakids1share, laseniors1, laseniors1share, lawhite1, lawhite1share, lablack1, lablack1share, laasian1, laasian1share, lanhopi1, lanhopi1share, laaian1, laaian1share, laomultir1, laomultir1share, lahisp1, lahisp1share, lahunv1, lahunv1share, lasnap1, lasnap1share, TractLOWI, TractKids, TractSeniors, TractWhite, TractBlack, TractAsian, TractNHOPI, TractAIAN, TractOMultir, TractHispanic, TractHUNV, TractSNAP
) %>%
  filter(complete.cases(.)) %>%
  filter(Urban == 1)

#ensure missing values are dropped

fara_subset <- fara_subset %>%
drop_na()

#convert all columns to numeric

fara_subset <- fara_subset %>%
  mutate_if(is.character, as.numeric)

fara_subest <- fara_subset %>% 
  mutate(Urban = as.factor(Urban),
         CensusTract = as.factor(CensusTract),
         County = as.factor(County))

str(fara_subset)

#Split the data into training and testing sets

set.seed(20201020)
fara_data_split <- initial_split(fara_subset, prop = 0.8, strata = LATracts1)
fara_train_data <- training(fara_data_split)
fara_test_data <- testing(fara_data_split)

#Create a recipe with (at least) themis::step_downsample(grade)
#Downsampling is one technique to deal with class imbalances.

fara_recipe <- recipe(LATracts1 ~ ., data = fara_train_data) %>%
  step_downsample(LATracts1)

#Exploratory data analysis (EDA)


#Histogram Poverty Rate and LATracts1 distribution 

ggplot(fara_train_data, aes(x = LATracts1)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribution of LATracts1",
       x = "LATracts1", y = "Count")

ggplot(fara_train_data, aes(x = PovertyRate)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribution of Poverty Rate",
       x = "Poverty Rate", y = "Count")


#poverty rate and Share of tract population that are beyond 1 mile from supermarket

fara_train_data %>%
ggplot(aes(x = PovertyRate, y = lapop1share, color = LATracts1)) +
geom_point(alpha = 0.5) +
theme_minimal()

#One mile low access tracts comparing share white and black

fara_train_data %>%
ggplot(aes(x = lablack1share, y = lawhite1share, color = LATracts1)) +
geom_point(alpha = 0.5) +
theme_minimal()

#One mile low access tracts comparing share kids and seniors

fara_train_data %>%
ggplot(aes(x = lakids1share, y = laseniors1share, color = LATracts1)) +
geom_point(alpha = 0.5) +
theme_minimal()


```